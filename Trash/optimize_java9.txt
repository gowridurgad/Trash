-- Read Java9
read "c:/users/kenne/documents/scrapejavaspec/java9.g4"

-- Parse is required.
parse

-- Clean up the annotation rule.
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'normalAnnotation']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'markerAnnotation']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'singleElementAnnotation']"
delete "//parserRuleSpec[RULE_REF/text() = 'normalAnnotation']"
delete "//parserRuleSpec[RULE_REF/text() = 'markerAnnotation']"
delete "//parserRuleSpec[RULE_REF/text() = 'singleElementAnnotation']"
rup
unify "//parserRuleSpec[RULE_REF/text() = 'annotation']//ruleAltList"

-- Clean up the compilationUnit rule.
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'ordinaryCompilationUnit']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'modularCompilationUnit']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'packageModifier']"
delete "//parserRuleSpec[RULE_REF/text() = 'ordinaryCompilationUnit']"
delete "//parserRuleSpec[RULE_REF/text() = 'modularCompilationUnit']"
delete "//parserRuleSpec[RULE_REF/text() = 'packageModifier']"
rup
unify "//parserRuleSpec[RULE_REF/text()='compilationUnit']"

-- Clean up the importDeclaration rule.
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'singleTypeImportDeclaration']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'typeImportOnDemandDeclaration']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'singleStaticImportDeclaration']"
unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'staticImportOnDemandDeclaration']"
delete "//parserRuleSpec[RULE_REF/text() = 'singleTypeImportDeclaration']"
delete "//parserRuleSpec[RULE_REF/text() = 'typeImportOnDemandDeclaration']"
delete "//parserRuleSpec[RULE_REF/text() = 'singleStaticImportDeclaration']"
delete "//parserRuleSpec[RULE_REF/text() = 'staticImportOnDemandDeclaration']"
rup
unify "//parserRuleSpec[RULE_REF/text() = 'importDeclaration']//ruleAltList"

-- Fold all lexer rules into parser string literals.
foldlit "//lexerRuleSpec/TOKEN_REF"

-- Clean up packageOrTypeName rule.
kleene //parserRuleSpec/RULE_REF[text()='packageOrTypeName']
kleene //parserRuleSpec/RULE_REF[text()='packageName']
kleene //parserRuleSpec/RULE_REF[text()='ambigousName']
rup

unfold "//parserRuleSpec//labeledAlt//RULE_REF[text() = 'assignmentOperator']"
delete "//parserRuleSpec[RULE_REF/text() = 'assignmentOperator']"

-- Clean up additiveExpression
kleene kleene //parserRuleSpec/RULE_REF[text()='additiveExpression']
rup
unify //parserRuleSpec[RULE_REF/text()='additiveExpression']//altList

-- Clean up relationalExpression
kleene //parserRuleSpec/RULE_REF[text()='relationalExpression']
rup
unify //parserRuleSpec[RULE_REF/text()='relationalExpression']//altList
unify //parserRuleSpec[RULE_REF/text()='relationalExpression']//altList//altList

-- Save
write

quit
